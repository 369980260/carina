



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>API automation - Carina</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#introduction" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Carina" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Carina
              </span>
              <span class="md-header-nav__topic">
                API automation
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/qaprosoft/carina/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Carina" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Carina
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/qaprosoft/carina/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Github
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting_started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../project_structure/" title="Project structure" class="md-nav__link">
      Project structure
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../execution/" title="Execution" class="md-nav__link">
      Execution
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Automation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Automation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../web/" title="Web automation" class="md-nav__link">
      Web automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mobile/" title="Mobile automation" class="md-nav__link">
      Mobile automation
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        API automation
      </label>
    
    <a href="./" title="API automation" class="md-nav__link md-nav__link--active">
      API automation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-test-implementation" title="Example of test implementation" class="md-nav__link">
    Example of test implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition-of-request-and-response-templates" title="Definition of request and response templates" class="md-nav__link">
    Definition of request and response templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rest-service-call-domain-object" title="REST service call domain object" class="md-nav__link">
    REST service call domain object
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-method-and-path" title="HTTP method and path" class="md-nav__link">
    HTTP method and path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-test" title="API test" class="md-nav__link">
    API test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-steps-once-again" title="Test steps once again" class="md-nav__link">
    Test steps once again
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-features" title="Useful features" class="md-nav__link">
    Useful features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wildcards" title="Wildcards" class="md-nav__link">
    Wildcards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-against-json-schema" title="Validation against JSON schema" class="md-nav__link">
    Validation against JSON schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-of-requests-with-an-array" title="Building of requests with an array" class="md-nav__link">
    Building of requests with an array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-of-responses-with-an-array" title="Validation of responses with an array" class="md-nav__link">
    Validation of responses with an array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deserialization-of-json" title="Deserialization of JSON" class="md-nav__link">
    Deserialization of JSON
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dataproviders/" title="Dataproviders" class="md-nav__link">
      Dataproviders
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contribution/" title="Contribution" class="md-nav__link">
      Contribution
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../proxy/" title="Proxy" class="md-nav__link">
      Proxy
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../migration/" title="Migration Steps" class="md-nav__link">
      Migration Steps
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../releases/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-of-test-implementation" title="Example of test implementation" class="md-nav__link">
    Example of test implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition-of-request-and-response-templates" title="Definition of request and response templates" class="md-nav__link">
    Definition of request and response templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rest-service-call-domain-object" title="REST service call domain object" class="md-nav__link">
    REST service call domain object
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-method-and-path" title="HTTP method and path" class="md-nav__link">
    HTTP method and path
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-test" title="API test" class="md-nav__link">
    API test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-steps-once-again" title="Test steps once again" class="md-nav__link">
    Test steps once again
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-features" title="Useful features" class="md-nav__link">
    Useful features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wildcards" title="Wildcards" class="md-nav__link">
    Wildcards
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-against-json-schema" title="Validation against JSON schema" class="md-nav__link">
    Validation against JSON schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-of-requests-with-an-array" title="Building of requests with an array" class="md-nav__link">
    Building of requests with an array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-of-responses-with-an-array" title="Validation of responses with an array" class="md-nav__link">
    Validation of responses with an array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deserialization-of-json" title="Deserialization of JSON" class="md-nav__link">
    Deserialization of JSON
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/qaprosoft/carina/edit/master/docs/automation/api.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>API automation</h1>
                
                <p><a href="https://youtu.be/oJL5y8Ovta0"><img alt="Carina - API automation" src="https://raw.githubusercontent.com/qaprosoft/carina/master/docs/img/video.png" /></a></p>
<h3 id="introduction">Introduction</h3>
<p>Rest API testing is a vital part of integration testing process, it may be used separately or in complex with web, mobile or DB testing. General process may be described by the following steps:</p>
<ol>
<li>Compile HTTP request with required meta data</li>
<li>Send prepared data to the required server endpoint</li>
<li>Validate HTTP status and response data</li>
<li>Extract some response data for the next requests</li>
<li>Build call to next (or same) endpoint using (or not using) data from the previous response</li>
</ol>
<p>Schema below demonstrates the sequence:
<img alt="API flow" src="../../img/api/api-flow-new.png" /></p>
<p>From that perspective we decided to use the following instruments:</p>
<ul>
<li>Rest-assured - "Testing and validation of REST services in Java is harder than in dynamic languages such as Ruby and Groovy. REST
Assured brings the simplicity of using these languages into the Java domain."</li>
<li>Freemarker - "Apache FreeMarker is a template engine: a Java library to generate text output (HTML web pages, e-mails, configuration
files, source code, etc.) based on templates and changing data."</li>
<li>JsonPath - library for extracting data from JSON body</li>
<li>JsonAssert - library for comparing of actual JSON body with expected one</li>
<li>Json-schema-validator - library for validating of JSON body for matching to json schema</li>
</ul>
<h3 id="example-of-test-implementation">Example of test implementation</h3>
<p>Let's create an automated test for next call: POST https://jsonplaceholder.typicode.com/users request with a request body</p>
<pre><code>[
    {
        &quot;id&quot;: 1,
        &quot;name&quot;: &quot;SOME_NAME&quot;,
        &quot;username&quot;: &quot;SOME_USERNAME&quot;,
        &quot;email&quot;: &quot;Sincere@april.biz&quot;,
        &quot;address&quot;: {
            &quot;street&quot;: &quot;Kulas Light&quot;,
            &quot;suite&quot;: &quot;Apt. 556&quot;,
            &quot;city&quot;: &quot;Gwenborough&quot;,
            &quot;zipcode&quot;: &quot;92998-3874&quot;,
            &quot;geo&quot;: {
                &quot;lat&quot;: &quot;-37.3159&quot;,
                &quot;lng&quot;: &quot;81.1496&quot;
            }
        },
        &quot;phone&quot;: &quot;1-770-736-8031 x56442&quot;,
        &quot;website&quot;: &quot;hildegard.org&quot;,
        &quot;company&quot;: {
            &quot;name&quot;: &quot;SOME_COMPANY_NAME&quot;,
            &quot;catchPhrase&quot;: &quot;Multi-layered client-server neural-net&quot;,
            &quot;bs&quot;: &quot;harness real-time e-markets&quot;
        }
    }
]
</code></pre>

<p>and response body same as the request body</p>
<h4 id="definition-of-request-and-response-templates">Definition of request and response templates</h4>
<p>If we are going to send POST request we have to create request template with some placeholders that may be replaced by different arguments for different test flows. The best place to store these resources is src/test/resources/api package, try to keep REST hierarchy in package structure for better maintenance and visibility:
<img alt="API flow" src="../../img/api/resources-structure.png" />
Request (rq.json) and response (rs.json) templates have some placeholders that will be populated from the tests later on:
<img alt="API flow" src="../../img/api/rq-example.png" />
<img alt="API flow" src="../../img/api/rs-example.png" />
While user.properties contains some default value which may be replaced later:
<img alt="API flow" src="../../img/api/props-example.png" /></p>
<h4 id="rest-service-call-domain-object">REST service call domain object</h4>
<p>Now we are ready to create REST service domain object which will be used to interact with web service and perform additional response validations. Our domain object is located in /carina-demo/src/main/java/com/qaprosoft/carina/demo/api, make sure that it extends AbstractApiMethodV2 and triggers base class constructor for initialization. In general case you will specify path to request and response templates along with default properties files (all of them were created in previous step). Also we replace URL placeholder to set appropriate environment.</p>
<pre><code>package com.qaprosoft.carina.demo.api;

import com.qaprosoft.carina.core.foundation.api.AbstractApiMethodV2;
import com.qaprosoft.carina.core.foundation.utils.Configuration;

public class PostUserMethod extends AbstractApiMethodV2 {
    public PostUserMethod() {
        super(&quot;api/users/_post/rq.json&quot;, &quot;api/users/_post/rs.json&quot;, &quot;api/users/user.properties&quot;);
        replaceUrlPlaceholder(&quot;base_url&quot;, Configuration.getEnvArg(&quot;api_url&quot;));
    }
}
</code></pre>

<h4 id="http-method-and-path">HTTP method and path</h4>
<p>The last step before test implementation itself is the association of domain object class and required HTTP method and path.
It should be defined in /carina-demo/src/main/resources/_api.properties file, key should be equal to domain class name, value has the following pattern {http_method}:{http_path}. HTTP path may contain placeholders, HTTP method should be one of the following variants: GET, POST, PUT, UPDATE, DELETE.</p>
<pre><code>#=====================================================#
#=================== API methods  ====================#
#=====================================================#
GetUserMethods=GET:${base_url}/users
PostUserMethod=POST:${base_url}/users
DeleteUserMethod=DELETE:${base_url}/users/1
PutPostsMethod=PUT:${base_url}/posts/1
PatchPostsMethod=PATCH:${base_url}/posts/1
</code></pre>

<h4 id="api-test">API test</h4>
<p>API test is the general TestNG test, a class should extend APITest, in our case test extend it over AbstractTest that encapsulates some test data and login method. Test is located in /carina-demo/src/test/java/com/qaprosoft/carina/demo.</p>
<pre><code>package com.qaprosoft.carina.demo;

import org.skyscreamer.jsonassert.JSONCompareMode;
import org.testng.annotations.Test;

import com.qaprosoft.apitools.validation.JsonCompareKeywords;
import com.qaprosoft.carina.core.foundation.AbstractTest;
import com.qaprosoft.carina.core.foundation.api.http.HttpResponseStatusType;
import com.qaprosoft.carina.core.foundation.utils.ownership.MethodOwner;
import com.qaprosoft.carina.demo.api.DeleteUserMethod;
import com.qaprosoft.carina.demo.api.GetUserMethods;
import com.qaprosoft.carina.demo.api.PostUserMethod;

public class APISampleTest extends AbstractTest {
    @Test(description = &quot;JIRA#DEMO-0001&quot;)
    @MethodOwner(owner = &quot;qpsdemo&quot;)
    public void testCreateUser() throws Exception {
        PostUserMethod api = new PostUserMethod();
        api.expectResponseStatus(HttpResponseStatusType.CREATED_201);
        api.callAPI();
        api.validateResponse();
    }

    @Test(description = &quot;JIRA#DEMO-0002&quot;)
    @MethodOwner(owner = &quot;qpsdemo&quot;)
    public void testCreateUserMissingSomeFields() throws Exception {
        PostUserMethod api = new PostUserMethod();
        api.getProperties().remove(&quot;name&quot;);
        api.getProperties().remove(&quot;username&quot;);
        api.expectResponseStatus(HttpResponseStatusType.CREATED_201);
        api.callAPI();
        api.validateResponse();
    }

    @Test(description = &quot;JIRA#DEMO-0003&quot;)
    @MethodOwner(owner = &quot;qpsdemo&quot;)
    public void testGetUsers() {
        GetUserMethods getUsersMethods = new GetUserMethods();
        getUsersMethods.expectResponseStatus(HttpResponseStatusType.OK_200);
        getUsersMethods.callAPI();
        getUsersMethods.validateResponse(JSONCompareMode.STRICT, JsonCompareKeywords.ARRAY_CONTAINS.getKey());
        getUsersMethods.validateResponseAgainstJSONSchema(&quot;api/users/_get/rs.schema&quot;);
    }
}
</code></pre>

<h4 id="test-steps-once-again">Test steps once again</h4>
<ol>
<li>Create REST call object</li>
<li>Specify properties for request/response placeholder</li>
<li>Add headers if required</li>
<li>Specify expected HTTP status</li>
<li>Call API</li>
<li>Validate response by template or parse some data by JSON path</li>
<li>Make further calls using data from the previous call if needed</li>
</ol>
<h3 id="useful-features">Useful features</h3>
<p>Framework contains a list of useful feature for requests building and for responses validation. That makes easier support of such tests and at the same time minimizes the amount of test data.</p>
<h4 id="wildcards">Wildcards</h4>
<p>In some cases you may need to generate data in the request to make request data unique. The best way of doing this is to use wildcards for data generation:</p>
<pre><code>{
    &quot;username&quot;: &quot;generate_word(10)&quot;,          // Will generate random alphanumeric string with 10 characters
    &quot;zip&quot;: &quot;generate_number(6)&quot;,              // Will generate random number with 6 digits
    &quot;birthday&quot;: &quot;generate_date(yyyy-MM-dd;0)&quot; // Will generate current date (first arg is date format, second is delta in days from now)
}
</code></pre>

<p>Other option is to specify placeholder in request template and then pass some generated value directly from the test method.</p>
<p>Another useful way of wildcards usage is response validation. In some cases you may need to skip some values or validate by regex:</p>
<pre><code>{
    &quot;id&quot;: &quot;skip&quot;,                                    // Will skip actual value validation and just verify id key presence
    &quot;signup_date&quot;: &quot;regex:\\d{4}-\\d{2}-\\d{2}&quot;,     // Will validate date value by specified regex
}
</code></pre>

<h4 id="validation-against-json-schema">Validation against JSON schema</h4>
<p>When you need to validate response structure regardless of the actual values you may use validation by JSON schema. In this case you need an actual response from service, let's say we have the following:</p>
<pre><code>{
    &quot;email&quot;: &quot;test@domain.com&quot;,
    &quot;firstName&quot;: &quot;SOME FIRST NAME&quot;,
    &quot;id&quot;: 11111
}
</code></pre>

<p>Now we need to generate a schema (you may use any generator you like for example https://jsonschema.net/).
IMPORTANT: For now schemas of version draft03 and draft04 are supported only. Please use the appropriate generator (e.g.  https://www.liquid-technologies.com/online-json-to-schema-converter)
In the tool like this you need to provide original JSON from response then choose some schema options (allow additional properties in objects, mark current object properties as required, hard-code some expected values, ect) and then generate the schema. Copy-paste generated schema into test resources and you're ready to use it in the test.
<img alt="API flow" src="../../img/api/schema-generator.png" />
Make sure that you change all flags required to true, after that create a new file in resources and place into appropriate endpoint package:</p>
<pre><code>{
    &quot;type&quot;:&quot;object&quot;,
    &quot;$schema&quot;: &quot;http://json-schema.org/draft-03/schema&quot;,
    &quot;id&quot;: &quot;http://jsonschema.net&quot;,
    &quot;required&quot;:true,
    &quot;properties&quot;:{
        &quot;email&quot;: {
            &quot;type&quot;:&quot;string&quot;,
            &quot;id&quot;: &quot;http://jsonschema.net/email&quot;,
            &quot;required&quot;:true
        },
        &quot;firstName&quot;: {
            &quot;type&quot;:&quot;string&quot;,
            &quot;id&quot;: &quot;http://jsonschema.net/firstName&quot;,
            &quot;required&quot;:true
        },
        &quot;id&quot;: {
            &quot;type&quot;:&quot;number&quot;,
            &quot;id&quot;: &quot;http://jsonschema.net/id&quot;,
            &quot;required&quot;:true
        }
    }
}
</code></pre>

<p>And finally we call JSON validation from Java test as following:</p>
<pre><code>@Test
public void testCheckJSONSchema()
{
    PostUserLoginMethod api = new PostUserLoginMethod();
    api.expectResponseStatus(HttpResponseStatusType.OK_200);
    api.callAPI();
    api.validateResponseAgainstJSONSchema(&quot;api/testdata/users/login/_post/rs.schema&quot;);
}
</code></pre>

<h4 id="building-of-requests-with-an-array">Building of requests with an array</h4>
<p>There are couple options for building request with an array of items provided by the framework:
1. First one use hardcoded placeholders for changeable variables.</p>
<pre><code>{
   &quot;name&quot;: &quot;${name}&quot;,
   &quot;description&quot;: &quot;${description}&quot;,
   &quot;label&quot;: &quot;${label}&quot;,
   &quot;taskTypes&quot;: [
      {
         &quot;name&quot;: &quot;${task_name_1}&quot;,
         &quot;description&quot;: &quot;${task_description_1}&quot;
      }
      &lt;#if task_name_2?exists || task_description_2?exists&gt;,
      {
         &quot;name&quot;: &quot;${task_name_2}&quot;,
         &quot;description&quot;: &quot;${task_description_2}&quot;
      }
      &lt;/#if&gt;
      &lt;#if task_name_3?exists || task_description_3?exists&gt;,
      {
         &quot;name&quot;: &quot;${task_name_3}&quot;,
         &quot;description&quot;: &quot;${task_description_3}&quot;
      }
      &lt;/#if&gt;
   ]
}
</code></pre>

<p>As you see this structure is pretty flexible. If you need 2 taskTypes items then you need to declare at least task_name_2 or task_description_2 property. If you need 3 items in addition to that you need to declare task_name_3 or task_description_3 property. Otherwise array will contain only 1 item.
For instance you need to build json which contains taskTypes array. Then template with placeholders will be following:
It's easy to extend such structure. You just need to add items with similar placeholders increasing their index.</p>
<ol>
<li>Another approach is based on using Freemarker loop. Here is the template example for the same JSON:</li>
</ol>
<pre><code>&lt;#if task_name_1?exists&gt;
    &lt;#assign task_names = [task_name_1]&gt;
    &lt;#assign task_descriptions = [task_description_1]&gt;
&lt;/#if&gt;   

&lt;#if task_name_2?exists&gt;
    &lt;#assign task_names = [task_name_1, task_name_2]&gt;
    &lt;#assign task_descriptions = [task_description_1, task_description_2]&gt;
&lt;/#if&gt;

&lt;#if task_name_3?exists&gt;
    &lt;#assign task_names = [task_name_1, task_name_2, task_name_3]&gt;
    &lt;#assign task_descriptions = [task_description_1, task_description_2, task_description_3]&gt;
&lt;/#if&gt;

{
   &quot;name&quot;: &quot;${name}&quot;,
   &quot;description&quot;: &quot;${description}&quot;,
   &quot;label&quot;: &quot;${label}&quot;,
   &quot;taskTypes&quot;: [
      &lt;#list 0..task_names?size-1 as i&gt;
      {
         &quot;name&quot;: &quot;${task_names[i]}&quot;,
         &quot;description&quot;: &quot;${task_descriptions[i]}&quot;
      }
      &lt;#if (i + 1) &lt; task_names?size&gt;,&lt;/#if&gt;
      &lt;/#list&gt;
   ]
}
</code></pre>

<p>This approach is useful when a structure of array item is pretty complex. So it makes sense to specify item attributes only once doing it inside #list operation.
This approach also allows to choose amount of array items dynamically.
But note that you should specify all properties for each item so this view can be not used for negative tests when you need to miss some properties.</p>
<h4 id="validation-of-responses-with-an-array">Validation of responses with an array</h4>
<p>Sometimes you could face a situation when you need to validate presence of only one (or couple) item in JSON array ignoring rest items.
In such case you can use validation option ARRAY_CONTAINS.
Here is code sample:</p>
<pre><code>JSONAssert.assertEquals(expectedRs, actualRs, new JsonKeywordsComparator(JSONCompareMode.STRICT,
                    JsonCompareKeywords.ARRAY_CONTAINS.getKey() + &quot;content&quot;));
</code></pre>

<p>Expected array:</p>
<pre><code>{
    &quot;totalElements&quot;: &quot;skip&quot;,
    &quot;pageNumber&quot;: &quot;skip&quot;,
    &quot;pageSize&quot;: &quot;skip&quot;,
    &quot;content&quot;: [
        {
            &quot;id&quot;: skip,
            &quot;brand&quot;: &quot;skip&quot;,
            &quot;clientName&quot;: &quot;CLIENT 1&quot;
        },
        {
            &quot;id&quot;: &quot;skip&quot;,
            &quot;brand&quot;: &quot;skip&quot;,
            &quot;clientName&quot;: &quot;CLIENT 2&quot;
        }
    ]
}
</code></pre>

<p>And the actual response:</p>
<pre><code>{
    &quot;totalElements&quot;: 1017,
    &quot;pageNumber&quot;: 0,
    &quot;pageSize&quot;: 100,
    &quot;content&quot;: [
        {
            &quot;id&quot;: 11111,
            &quot;brand&quot;: &quot;test&quot;,
            &quot;clientName&quot;: &quot;CLIENT 1&quot;
        },
        {
            &quot;id&quot;: 22222,
            &quot;brand&quot;: &quot;test&quot;,
            &quot;clientName&quot;: &quot;CLIENT 2&quot;
        },
        {
            &quot;id&quot;: 3333,
            &quot;brand&quot;: &quot;test&quot;,
            &quot;clientName&quot;: &quot;CLIENT 3&quot;
        },
        {
            &quot;id&quot;: 4444,
            &quot;brand&quot;: &quot;test&quot;,
            &quot;clientName&quot;: &quot;CLIENT 4&quot;
        }
    ]
}
</code></pre>

<h3 id="deserialization-of-json">Deserialization of JSON</h3>
<p>Sometimes you may need to transform your json response to POJO. It may be useful if you need to validate your response using data from the database as expected data.
For that purposes it's better to use Jackson libraries that are already included in carina framework.
For that you have to prepare domain class based on your json structure. Some online resources provide such opportunities. For instance https://timboudreau.com/blog/json/read
For example we need to deserialize array of Clients from json. Example of required domain object will be:</p>
<pre><code>import org.codehaus.jackson.annotate.JsonCreator;
import org.codehaus.jackson.annotate.JsonProperty;
public final class Clients
{
    public final Client clients[];
    @JsonCreator
    public Clients(@JsonProperty(&quot;clients&quot;) Client[] clients)
    {
        this.clients = clients;
    }
    public static final class Client
    {
        public final long id;
        public final String brand;
        public final String clientName;
        ......
        @JsonCreator
        public Client(@JsonProperty(&quot;id&quot;) long id, @JsonProperty(&quot;brand&quot;) String brand, @JsonProperty(&quot;clientName&quot;) String clientName,.....)
        {
            this.id = id;
            this.brand = brand;
            this.clientName = clientName;
            .........
        }
    }
    public Client[] getClients()
    {
        return clients;
    }
}
</code></pre>

<p>Pay attention that POJO fields names could differ from json properties. In this case @JsonProperty annotation can be used for mapping.
Example of deserialization code:</p>
<pre><code>GetClientsMethod getClientsMethod = new GetClientsMethod(&quot;11111&quot;);
getClientsMethod.expectResponseStatus(HttpResponseStatusType.OK_200);
String rs = getClientsMethod.callAPI().asString();
ObjectMapper mapper = new ObjectMapper();
Clients clients = mapper.readValue(rs, Clients.class);
</code></pre>

<p>Then you can use POJO object for any kind of validation or for easy retrieving of required properties.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../mobile/" title="Mobile automation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Mobile automation
              </span>
            </div>
          </a>
        
        
          <a href="../../dataproviders/" title="Dataproviders" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Dataproviders
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>